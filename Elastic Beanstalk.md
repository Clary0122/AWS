# Elastic Beanstalk
## Elastic Beanstalk란?
- 애플리케이션을 실행하는 인프라에 대해 자세히 알지 못해도 AWS 클라우드에 애플리케이션을 신속하게 배포하고 관리 가능
- 관리 복잡성 ↓ : 애플리케이션 업로드만 하면 알아서 **용량 프로비저닝, 로드 밸런싱, 조정 애플리케이션 상태 모니터링**에 대한 세부 정보를 자동으로 처리
- Go, Java, NET, Nods.js, PHP, Python, Ruby로 개발한 애플리케이션 지원
- 배포할 때, EB는 선택된 플랫폼 버전을 구축하고 EC2 등의 AWS 리소스를 하나 이상 프로비저닝하여 애플리케이션을 실행
- 상호작용 방법 : EB 콘솔, AWS CLI, eb(EB를 위해 특별히 설계된 고급 CLI)
- EB 콘솔에서 직접 EC2 인스턴스 플릿 크기 변경 가능, 모니터링 가능

### 시용방법
![image](https://user-images.githubusercontent.com/79209568/170908377-2e69ad46-59e7-4ab2-b5c8-4e5887ce7b95.png)
#### 1. Create Application
#### 2. Upload Version
- 애플리케이션 소스 번들 형태 (예 자바의 경우 .war 파일)로 애플리케이션 버전을 업로드한다.
- 애플리케이션에 대한 몇 가지 정보를 제공
#### 3. Launch Environment
- 자동으로 환경을 실행하고 코드 실행에 필요한 AWS 리소스를 생성 및 구성
#### 4. Manage Environment
- 환경 실행 후 EB가 환경을 직접 관리
- 새로운 앱 법전 배포 가능

### 요금
- EB에 대한 추가 비용은 없지만 애플리케이션에서 사용할 **기본 AWS 리소스에 대한 비용은 필요**

## 주요 개념
|개념|설명|
|--|----|
|애플리케이션|- 환경, 버전 및 환경구성을 포함한 EB 구성 요소의 논리적 컬렉션.<br>- 개념적으로 폴더와 유사|
|애플리케이션 버전|- Java WAR 파일 등의 배포 가능한 코드가 포함된 S3 객체를 가리킨다.<br>- 애플리케이션의 일부. 애플리케이션 내에 많은 버전이 있을 수 있지만 각 애플리케이션 버전은 고유한 이름을 가져야한다.<br>- 실행 중인 환경에서 버전을 업로드하고 즉시 배포 가능<br>- 여러 버전을 업로드하여 한 웹 애플리케이션 버전과 다른 버전 간의 차이 테스트 가능.|
|환경|- 애플리케이션 버전을 실행 중인 AWS 리소스 모음.<br>- 각 환경에서 한번에 하나의 애플리케이션 버전만 실행 가능.<br>- 환경을 생성하면 EB에서 사용자가 지정한 애플리케이션 버전을 실행하는 데 필요한 리소스를 프로비저닝 함.|
|환경 티어|- 환경을 생성할 때 환경티어를 선택한다. <br>- 환경에서 실행하는 애플리케이션 유형 지정, 프로비저닝하는 리소스 결정.<br>- HTTP 요청을 처리하는 애플리케이션은 [**웹 서버 환경 티어**](#웹-서버-환경), Amazon SQS 대기열에서 작업을 가져오는 백엔드 환경은 [**작업자 환경 티어**](#작업자-환경)에서 실행|
|플랫폼|운영체제(OS), 프로그래밍 언어 런타임, 웹 서버, 애플리케이션 서버 및 EB 구성 요성의 조합|

### 환경 티어
#### 웹 서버 환경
![image](https://user-images.githubusercontent.com/79209568/171077716-c66311dd-064c-4d2c-8068-fc31406366c5.png)
<아키텍처 예제>  
- 환경 생성 시 EB는 애플리케이션을 실행하는 데 필요한 리소스를 프로비저닝한다. (하나 이상의 ELB, Auto Scaling 그룹, EC2)
- 로드 밸런서를 가리키는 CNAME(URL)이 있다. (Myapp.elasticbeanstalk.com) 이 URL은 Route 53을 통해 ELB의 URL로 별칭 지정 가능. (Myelb.elb.amazoneaws.com)
- Auto Scaling이 로드 증가 감소에 따라 EC2를 중지 실행한다. 하지만 최소 한 개의 인스턴스는 실행 상태로 둔다.
- 각 인스턴스에는 호스트관리자(HM)라는 소프트웨어 구성 요소가 실행된다.
  - 호스트 관리자
    - 애플리케이션 배포
    - 콘솔, API, CLI을 통해 검색을 위해 이벤트와 측정치 집계
    - 인스턴스 수준 이벤트 생성
    - 애플리케이션 로그 파일을 모니터링하여 심각한 오류 검출
    - 애플리케이션 서버 모니터링
    - 인스턴스 구성 요소 패칭
    - 애플리케이션의 로그 파일을 교체하고 이를 S2에 게시
- 보안 그룹을 통해 인스턴스의 방화벽 규칙을 정의한다. 기본적으로 EB가 보안 그룹을 정의하며 이를 통해 80 포트를 사용하여 사용자가 연결할 수 있다.
- 보안 그룹을 두 개 이상 정의한다. 예를 들어 DB 서버와 EC2 서버
#### 작업자 환경
![image](https://user-images.githubusercontent.com/79209568/171080622-afdc638f-adb2-41e8-9168-a33227ac75f3.png)
<아키텍처 예제>
- 환경 생성 시 프로비저닝 되는 리소스들은 Auto Scaling 그룹, 하나 이상의 EC2, IAM 역할, SQS이다.
- Amazon SQS 대기열이 아직 없으면 EB가 만들어서 프로비저닝 한다.
- 작업자 환경을 시작하면 선택한 프로그래밍 언어에 필요한 지원 파일과 데몬을 각 EC2에 설치한다. 
- 데몬이 SQS 대기열로부터의 메시지를 읽은 후 처리를 위해 각 메시지의 데이터를 실행 중인 웹 어플리케이션에 보낸다. 
- 여러 개의 인스턴스가 있는 경우 각 인스턴스의 고유의 데몬이 있지만 모두 동일한 SQS 대기열을 읽는다.
## 설계 고려 사항
### 확장성
- Auto Scaling 설정을 통해 서버 사용률 또는 네트워크 I/O 지표로 자동으로 EC2 추가, 제거할 수 있도록 가능하다.
- 시스템 지표를 CloudWatch에 게시한 후 Auto Scaling 작업을 트리거하거나 알림 전송으로 경보를 구성할 수 있다.
- EB의 모든 애플리케이션은 필요에 따라 확장할 수 있는 느슨하게 결합된 내결함성 구성요소를 사용하며 가급적 상태 비저장으로 설계하는 것이 좋다.
### 보안
- 애플리케이션과 클라이언트 사이에 흐르는 정보를 보호하기 위해 SSL을 구성한다.
- Amazon ACM, CA(외부인증기관)인증서 등
- 환경에 SSL 인증서를 구성하면 클라이언트와 환경의 ELB 간에 데이터가 암호화된다. 이 암호화는 기본적으로 ELB에서 종료되고 ELB와 EC2 인스턴스 간의 트래픽은 암호화되지 않는다.
### 영구 스토리지
- EB 애플리케이션은 영구 로컬 스토리지가 없는 EC2 인스턴스에서 실행되므로 종료되면 로컬 파일 시스템이 저장되지 않는다. 
- 영구 스토리지에 데이터를 저장하도록 애플리케이션을 구성하는 것이 좋다. (S3, File System, DynamoDB, RDS)
- Amazon Linux 2 플랫폼 버전의 경우, EB는 웹앱 사용자에게 새로운 환경에 대한 uid(사용자 ID) 및 gid(그룹 ID) 값 **900**을 할당한다. 이 웹앱 사용자는 플랫폼 업데이트에도 영구 파일 시스템 스토리지에 대한 일관된 액세스 허가를 유지할 수 있다. 만약 이미 다른 사용자나 프로세스가 900을 사용 중이면 운영체제가 알아서 다른 기본 값을 준다. (`id webapp`으로 할당 된 uid, gid 확인 가능)
### 내결함성
- 항상 장애 시 자동 복구할 수 있도록 설계, 구현 및 배포한다. 
  - 여러 가용 영역에 EC2, RDS를 둔다.
  - CloudWatch를 사용하여 EB 애플리케이션 상태를 쉽게 확인하여 하드웨어 장애나 성능 저하 시 적절한 조치를 취한다.
  - 비정상 EC2를 새 인스턴스로 바꾸도록 Auto Scaling 구성을 해 놔서 EC2 인스턴스를 일정한 크기로 유지한다.
  - RDS를 사용하면 자동 백업을 수행하도록 백업의 보존 기간을 설정한다.
### 콘텐츠 전송
- CloudFront 사용
### 소프트웨어 업데이트 및 패칭
- 
### 연결성
