# 클라우드 비용 어떻게 줄일 수 있을까
## 비용 데이터 수집
### 데이터 확인
#### 1. Billing Dashboard
- AWS 클라우드 전반적인 비용 확인
- 전체 지출의 대부분 사용하는 서비스가 무엇인지, 전 달 대비 얼마나 사용하고 있는지 확인 가능
#### 2. Bills
- 왼쪽 상단 **청구서(Bills)** 서비스 별로 과금 된 서비스를 월 별로 확인 가능
#### 3. Reports
- 비용 및 사용량 보고서(Cost and Usage Report, CUR) : 시간 당 비용 세분화

### 툴
#### 4. Trusted Advisore
- 전반적인 인프라 환경을 점검해주는 서비스
- 5가지 분야 : 비용 최적화, 성능, 보안, 내결함성, 서비스 한도

#### 5. Cost Explorer (비용탐색기)
- AWS 비용을 시각화 해서 빠르게 문제점을 찾아주는 서비스

> #### 여기까지로 서비스 별 비용 확인, 불필요 자원 유무를 확인 가능하지만 해당 리소스의 주인이 누구인지 어떠한 목적으로 사용되고 있는 지 등은 확인 불가.

### 정책
#### 6. 태깅
![image](https://user-images.githubusercontent.com/79209568/166418746-f8c666bf-5379-4265-b02c-0855c24541d1.png)
- 클라우드 비용도 해당 리소스를 어느 팀에서 어떠한 목적으로 사용하고 있는지 볼 수 있는 것이 매우 중요
- AWS는 거의 모든 리소스에 key, value로 태깅이 가능
- 프로젝트 시작 전, 팀원들과 태깅 정책을 세워서 리소스가 어디에 속하는 지 확인하고 체계적으로 관리하는 것이 중요

## 비용 줄이기
### Rightsizing
#### 인스턴스 사이즈
- 과거 On-premise 환경에서는 최대를 예상하고 리소스를 크게 잡아 구축했지만 On-demand 환경인 클라우드에서는 auto-scailing과 같은 서비스를 사용해 수요와 맞춰 인스턴스 확장이 가능
- rightsizing 검사 방법
  - 테스트 환경에서 최소한의 인스턴스를 시작
  - `Amazon CloudWatch`와 같은 모니터링 툴을 이용해 CPU나 다른 매출정보를 확인하여 사이즈 변경
#### 인스턴스 타입
- 워크로드에 맞는 인스턴스 타입을 선택  
![image](https://user-images.githubusercontent.com/79209568/166421070-c5ad4023-a60c-4c15-8c32-0396a4e0a913.png)  
- 범용 인스턴스인 **M**으로 시작 혹은 **T** → 테스트로 사용해보기
- CPU를 많이 사용한다? → **C**
- 메모리가 많이 필요하다? → **R**

### Elasticity
#### 인스턴스 스케줄링
- 인스턴스를 오래 켜둘수록 과금되기 때문에 안 쓸때는 꺼두어야한다.
- **AWS Instance Scheduler** : 스케줄링 자동화 서비스
  - 두 개의 DynamoDB가 자동으로 생성됨
  - config 테이블에서 시간과 요일 등 기본적인 설정이 가능
  - 설정 완료 후 종료하고 싶은 인스턴스에 태깅을 하면 Instance Scheduler가 태깅을 보고 설정해놓은 값에따라 중지를 진행
  - 예) 월-금, 9:00-18:00 동안만 'Schedule' 태그의 인스턴스가 사용되도록 설정  
    ![image](https://user-images.githubusercontent.com/79209568/166422357-2d14c4c4-0168-4986-acb9-6e9bc2391cab.png)  
 
### Pricing
- 가격 옵션을 선택해서 비용을 줄일 수 있다.
- 온디맨드, 예약 인스턴스, 스팟 인스턴스  
[ㄷ**01_AWS와 함께하는 클라우드 컴퓨팅**의 **과금 옵션 및 비용 최적화**에서 정리](https://github.com/Clary0122/AWS/blob/main/AWS%20Builders%20100/01_AWS%EC%99%80%20%ED%95%A8%EA%BB%98%ED%95%98%EB%8A%94%20%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C%20%EC%BB%B4%ED%93%A8%ED%8C%85.md#amazon-ec2)

#### 온디맨드
- 사용한 만큼 지불하는 기본옵션
#### 예약 인스턴스(Reserved Instance)
- 물리적 인스턴스가 **아닌!** 온디맨드 인스턴스를 사용할 때 적용되는 할인 쿠폰 개념과 같음
- 크게 세 가지로 구분 됨
  |제공클래스|기간|결제옵션|
  |--|--|--|
  |표준(할인율↑)|1년(할인율↓)|전체선결제|
  |컨버터블(할인율↓)|3년(할인율↑)|부분선결제|
  |||선결제없음|
    - 표준 : 한번 구입시 변경이 불가하지만 할인율이 컨버터블보다 높음(데이터베이스)
    - 컨버터블 : 구매한 후에도 인스턴스 패밀리, OS, 테넌시 등 유연하게 변경이 가능. 할인율이 표준보다 낮음
    - 전체 선결제 : 전액을 선납으로 지불
    - 부분 선결제 : 절반의 금액만 선납으로 지불 후 나머지 금액을 할인 받음
    - 선결제 없음 : 선납금은 없지만 1년 약정으로 할인을 받음  

![image](https://user-images.githubusercontent.com/79209568/166615064-9e51e432-fe44-4922-81b2-f0b7a532fc85.png)  
  - 전체 선결제와 부분 선결제 할인율 차이가 크게 없음! 부분 선결제로 현금 확보 가능
- EC2 뿐만 아니라 RDS, Redshift, Elasticsearch Service, ElastiCache 등 다양한 서비스에서도 할인 가능
- RI 구매 방법
  - `콘솔의 EC2 서비스 선택` → `왼쪽 상단 예약 인스턴스` → `예약 인스턴스 구매 버튼` → `옵션 선택`
  ![image](https://user-images.githubusercontent.com/79209568/166615234-e6f29a7e-c8ac-4a8a-8711-36198680e471.png)

#### 스팟 인스턴스(Spot Instance)
- 전 세계 많은 국가에서 데이터 센터를 운영하고 있기 때문에 큰 규모의 컴퓨팅 용량을 보유하고 있음
- 이에 따라 사용되지 않는 잉여 컴퓨팅 자원이 존재하고, 잉여 자원을 고객에게 저렴한 가격으로 제공
- 시간에 구애받지 않는 워크로드(내부 리서치 작업, 테스트환경, 고객 서비스에 영향이 없는 배치작업)에 적합
- 예비 컴퓨팅 자원이기 때문에 해당 인스턴스가 AWS에서 다시 필요할 경우 알람을 주고 **중단 될 가능성** 있음
- 스팟 인스턴스의 가격 안정화
  - 과거에는 입찰 방식으로 진행되어 가격을 예측하기 매우 어려웠음
  - 17년 12월 이후, 입찰 방식이 아닌 AWS가 가지고 있는 컴퓨팅의 수요와 공급에 따라서만 제공
- 중단 빈도 확인 : **스팟 인스턴스 어드바이저**

#### pricing 요약
![image](https://user-images.githubusercontent.com/79209568/166615768-04e8b805-fe5e-494a-afa6-5b3f849397fa.png)

### Storage
- 오브젝트 스토리지, 블록 스토리지
#### 오브젝트 스토리지
> #### 대표적 : S3
- S3 Standard : 가장 기본 옵션
- S3 INT-TIER : 파일이 자주 사용되는지 모를 때 사용. AWS가 액세스 패턴을 분석해서 변경될 때 마다 액세스 티어 간의 데이터를 이동시켜서 비용을 자동으로 절약해주는 스토리지 옵션
- S3 S-IA : 자주 액세스하지 않는 데이터에 사용하는 스토리지 옵션
- S3 One Zone : S3 IA와 동일하지만 하나의 가용영역만을 사용해 기존 IA보다 더 저렴하게 사용가능
- Glacier : 아카이브 스토리지

#### 블록 스토리지
> #### 대표적 : EBS
- S3 보다 가격이 높음
- 사용 전에 워크로드가 IOPS가 중요한지 Throughput이 중요한지 확인 필요
  > \<용어정리>
  > - 아이옵스(Input/Output Operations Per Second, IOPS) : HDD, SSD, SAN 같은 컴퓨터 저장 장치를 벤치마크한느 데 사용되는 성능 측정 단위 (스토리지의 가장 대표적인 성능 지표)
  > - 벤치마크(benchmark) : 컴퓨팅에서 특정 오브젝트(하드웨어 또는 소프트웨어 등)에 대해 일반적으로 수많은 표준 테스트와 시도를 수행함으로써 오브젝트의 상대적인 성능 측정을 목적으로 컴퓨터 프로그램을 실행하는 행위
  > - 스루풋(throughput) 또는 처리율 : 통신에서 네트워크 상의 어떤 노드나 터미널로부터 또 다른 터미널로 전달되는 단위 시간당 디지털 데이터 전송으로 처리하는 양
  
![image](https://user-images.githubusercontent.com/79209568/166617219-2fc78d27-ea3c-4c8b-b7e0-12784bf3fe5a.png)


> 추가 정보
> ![image](https://user-images.githubusercontent.com/79209568/166617399-b7b18256-3b42-4811-b0c5-e4fbd638120b.png)

